# 后端测试设计

## 测试目标

- 覆盖所有核心业务接口（用户、笔记、标签、收藏等）
- 验证接口的正常流程、异常处理、权限校验、边界场景
- 保证代码变更后功能稳定、无回归

## 测试范围

1. 用户模块
   - 注册、登录、重复注册、错误登录
   - 权限校验（如不能操作他人数据）
2. 笔记模块
   - 创建、更新、删除、搜索
   - 边界值（空、超长、特殊字符）
   - 并发/幂等性
3. 标签模块
   - 创建、获取、更新、删除
   - 标签与笔记关联/解绑
   - 重复标签、非法参数
4. 收藏模块
   - 收藏、取消收藏、收藏状态、收藏列表
   - 重复收藏、未收藏取消
5. 权限与异常
   - 未登录/无权限访问
   - 非法参数、对象不存在、数据库异常

## 测试方法

- 使用 pytest 进行自动化测试
- 通过 fixture 管理测试数据和登录态
- 断言接口响应、数据库变更、权限限制
- 测试用例互相隔离，保证可重复运行

## 注意事项

- 数据库隔离：每个测试用例前后自动回滚，避免数据污染
- Mock 外部依赖：如 summary_agent、第三方 API
- 并发/事务测试：模拟多用户并发、事务回滚

## 目录结构

```md
tests/
  conftest.py         # 公共 fixture
  test_user.py        # 用户相关测试
  test_note.py        # 笔记相关测试
  test_tag.py         # 标签相关测试
  test_favorite.py    # 收藏相关测试
  后端测试设计.md      # 测试设计文档
```

## 主要用例

- 用户注册成功/失败/重复
- 登录成功/失败
- 创建/更新/删除/搜索笔记
- 创建/更新/删除标签
- 收藏/取消收藏/收藏状态
- 权限校验（如不能操作他人数据）
- 边界值（如超长、空、特殊字符）
- 异常场景（如对象不存在、数据库错误）
